<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ImgLib2 and BigDataViewer projects - ImgLib2 Discussion</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="ImgLib2 and BigDataViewer projects - ImgLib2 Discussion">
<meta property="og:description" content="">
<meta property="og:site_name" content="ImgLib2 and BigDataViewer projects">
</head>

<body class="nav-sidebar docked nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ImgLib2 and BigDataViewer projects</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../imglib2"> 
<span class="menu-text">ImgLib2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../bdv"> 
<span class="menu-text">BDV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../resources/imglib2_links.html"><i class="bi bi-info-square" role="img">
</i> 
 <span class="dropdown-text">ImgLib2 links</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../resources/bigdataviewer_links.html"><i class="bi bi-info-square" role="img">
</i> 
 <span class="dropdown-text">BigDataViewer links</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/imglib"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">ImgLib2 github</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/bigdataviewer"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">BigDataViewer github</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../ecosystem.html"> 
<span class="menu-text">Ecosystem</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-contributing-guidelines" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Contributing Guidelines</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-contributing-guidelines">    
        <li>
    <a class="dropdown-item" href="../contribute/guidelines_for_imglib2.html"><i class="bi bi-share" role="img">
</i> 
 <span class="dropdown-text">Guidelines for ImgLib2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contribute/guidelines_for_bigdataviewer.html"><i class="bi bi-share" role="img">
</i> 
 <span class="dropdown-text">Guidelines for BigDataViewer</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contribute/our_code_of_conduct.html"><i class="bi bi-peace" role="img">
</i> 
 <span class="dropdown-text">Our Code-of-conduct</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@imglib2"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../imglib2/discussion.html">ImgLib2 Discussion</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/accessibles.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 - Accessibles</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/accessors.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 - Accessors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 Algorithms</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/benchmarks.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 Benchmarks</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/changes-from-imglib1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Changes from ImgLib1 to ImgLib2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/developing.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Developing ImgLib2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/discussion.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">ImgLib2 Discussion</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/documentation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 Documentation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/examples.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 Examples</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/faq.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 FAQ</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/gauss-package.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Gauss package for ImgLib2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/getting-started.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 - Getting Started</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/loopbuilder.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">LoopBuilder</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/matlab.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Creating Imglib2 images in MATLAB</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/migrate-from-imglib1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">How To Migrate Code From ImgLib To ImgLib2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/morphological-operations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 Morphological Operations</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/workshop-advanced.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 - Advanced Programming Workshop</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../imglib2/workshop-introductory.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">ImgLib2 - Introductory Workshop</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">ImgLib2 Discussion</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/imglib/imglib2-www/blob/main/imglib2/discussion.md"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section">2011-03-16</h2>
<p>Tobias and Saalfeld found it a great idea to create this discussion page that, if ever possible, will be filled with the daily conceptual discussions and results. That way, all interested people can contribute and keep track on what we’re trying to tackle next.</p>
<section id="we-discussed-the-view-concept" class="level3">
<h3 class="anchored" data-anchor-id="we-discussed-the-view-concept">We discussed the View concept:</h3>
<p>Summary is that <code>View\&lt;T\&gt;</code> would be an interface that can return its target <code>T</code>, the data it is generated from:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> <span class="bu">View</span><span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> T <span class="fu">getTarget</span><span class="op">();</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>A <code>View</code> is an <code>[...]Accessible</code> that provides possibly transformed access to a subset of this target data.</p>
<p>Since we could not see any reasonable application for the bare <em>View</em> interface, we will not implement it but use it in informal speech about virtualized access. We will also use <em>Target</em> to refer to the underlying data.</p>
<p>Examples are <code>IterableIntervalSubset</code>, arbitrary Neighborhoods, <code>RandomAccessibleView</code> (formerly called View), <code>RealRandomAccessibleView</code>, <code>TransformedRandomAccessibleView</code>, <code>StructuredElement</code>, <code>HyperShpere</code>, <code>SuperInterval</code>…</p>
</section>
<section id="we-discussed-the-view-concept-again-and-transforms" class="level3">
<h3 class="anchored" data-anchor-id="we-discussed-the-view-concept-again-and-transforms">We discussed the View concept (again) and Transforms:</h3>
<p>We agreed that for Views that give transformed access it is more natural to specify the transform with respect to the underlying data. That is, the transform is applied to a coordinate in the data system to obtain a coordinate in the view system.</p>
<p>In matrix notation, a transform would look like <strong>y = Tx</strong>. Here, it is natural to refer to <strong>x</strong> as the <em>source</em> vector and to <strong>y</strong> as the <em>target</em> vector.</p>
<p>Applied to Views, we will therefore completely reverse our previous opinion and refer to the underlying data as the <em>Source</em>.</p>
<p>The <code>View\&lt;T\&gt;</code> interface would look like</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> <span class="bu">View</span><span class="op">&lt;</span>T<span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> T <span class="fu">getSource</span><span class="op">();</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For Transforms, we will adapt and simplify the <code>CoordinateTransform</code> and related interfaces from Fiji’s mpicbg submodule. There will be an integer and a real version as for <code>Positionable</code> and <code>Localizable</code>. <code>Transform</code> and <code>RealTransform</code> can specify the number of dimensions of its source and target domain. They look like</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> <span class="bu">Transform</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">numSourceDimensions</span><span class="op">();</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">numTargetDimensions</span><span class="op">();</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply</span><span class="op">(</span><span class="dt">long</span><span class="op">[]</span> source<span class="op">,</span> <span class="dt">long</span><span class="op">[]</span> target<span class="op">);</span></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply</span><span class="op">(</span>Localizable source<span class="op">,</span> Positionable target<span class="op">);</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> RealTransform <span class="op">{</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">numSourceDimensions</span><span class="op">();</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">numTargetDimensions</span><span class="op">();</span></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply</span><span class="op">(</span><span class="dt">double</span><span class="op">[]</span> source<span class="op">,</span> <span class="dt">double</span><span class="op">[]</span> target<span class="op">);</span></span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">apply</span><span class="op">(</span>RealLocalizable source<span class="op">,</span> RealPositionable target<span class="op">);</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The apply methods transfer source coordinates into target coordinates.</p>
<p>There will be an invertible version for each of these interfaces</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> IvertibleTransform <span class="kw">extends</span> <span class="bu">Transform</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">applyInverse</span><span class="op">(</span><span class="dt">long</span><span class="op">[]</span> source<span class="op">,</span> <span class="dt">long</span><span class="op">[]</span> target<span class="op">);</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">applyInverse</span><span class="op">(</span>Positionable source<span class="op">,</span> Localizable target<span class="op">);</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    InvertibleTransform <span class="fu">inverse</span><span class="op">();</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> IvertibleRealTransform <span class="kw">extends</span> RealTransform <span class="op">{</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">applyInverse</span><span class="op">(</span><span class="dt">double</span><span class="op">[]</span> source<span class="op">,</span> source<span class="op">[]</span> target<span class="op">);</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">applyInverse</span><span class="op">(</span>RealPositionable source<span class="op">,</span> RealLocalizable target<span class="op">);</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    InvertibleRealTransform <span class="fu">inverse</span><span class="op">();</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note that <code>target</code> is transferred into <code>source</code> in that case.</p>
<p>We have extensively discussed the fact that for rendering a mapped image, an inverse transformation is required whereas one prefers to define transformations in the forward manner. Nevertheless, a view (renderer) should use the forward defined instance of a <code>Transform</code> to create its result with changes applied to that transform having a direct effect on the result (no creation of a fresh `inverse’). Other than in mpicbg, we will achieve this by implementing Renderers for forward transformations (those transformations that can be specified in one direction only will be defined as forward transformations). For invertible transformations, the Renderer will use a final <code>Inverter</code> that is a forward transformations that uses the inverse apply methods of an invertible transformation for its apply method.</p>
</section>
<section id="how-to-proceed-with-the-imglib2-namespace" class="level3">
<h3 class="anchored" data-anchor-id="how-to-proceed-with-the-imglib2-namespace">How to proceed with the imglib2 namespace?</h3>
<p>We think that it would be a great idea to be able to run both imglib and imglib2 together. This would relieve us from the need to port all the legacy imglib code into imglib2. Also, a shorter package hierarchy would be nice. With <code>org.imglib2</code>, we would match the Maven convention and the URL is still not registered…</p>
<p>Why not just call it <code>org.imglib</code> then? Wouldn’t clash with <code>mpicbg.imglib</code> of imglib1.</p>
<p>Because imglib.org is registered by somebody else already. {% include person id=‘axtimwalde’ %} 14:38, 24 March 2011 (CET)</p>
</section>
</section>
<section id="section-1" class="level2">
<h2 class="anchored" data-anchor-id="section-1">2011-03-21</h2>
<section id="efficient-access-for-randomaccessibleviews" class="level3">
<h3 class="anchored" data-anchor-id="efficient-access-for-randomaccessibleviews">Efficient access for RandomAccessibleViews</h3>
<p>I’ve been thinking all day about a reasonable concept for concatenation and simplification of <code>Transforms</code> for <code>RandomAccessibleViews</code>. No satisfying result so far, so at least I want to start writing down what it might look like in the end and what the problems are.</p>
<section id="simplifying-view-transformations" class="level4">
<h4 class="anchored" data-anchor-id="simplifying-view-transformations">Simplifying View Transformations</h4>
<p>The idea is that a view should always give you a <code>RandomAccess</code> that is as efficient as possible. When views are layered on top of each other it is often possible to combine and simplify their transformations.</p>
<p>Assume that we have a 90 degree rotated view <strong>A</strong> of an image <strong>I</strong>. and a 90 degree rotated view <strong>B</strong> of that view <strong>A</strong>. A <code>RandomAccess</code> on <strong>B</strong> could simply rotate by 90 degree and wrap a <code>RandomAccess</code> on <strong>A</strong>. The <code>RandomAccess</code> on <strong>A</strong> would in turn simply rotate by 90 degree and wrap a <code>RandomAccess</code> on <strong>I</strong>.</p>
<p>However, this would not a good idea for a hierarchy of many views. Instead, when we request a <code>RandomAccess</code> from <strong>B</strong> then we would like one that directly wraps a <code>RandomAccess</code> on <strong>I</strong> and rotates coordinates by 180 degree.</p>
<section id="transformable-leek" class="level5">
<h5 class="anchored" data-anchor-id="transformable-leek">Transformable (leek)</h5>
<p>Coincidentally, I was playing around with an idea for ROIs that might be applicable here. You’d like to be able to take a ROI in one space, apply a transform and get a ROI in the transformed space by transforming key internal coordinates. So that lead me to think of making ROIs implement “Transformable” if they wanted to. The some transformation could be applied to a transform itself - have a transform implement transformable so that its internal matrix could get re-jiggered to operate in the new space.</p>
<p>Here’s the interface that I was planning on implementing:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="kw">package</span><span class="im"> mpicbg</span><span class="op">.</span><span class="im">imglib</span><span class="op">.</span><span class="im">transform</span><span class="op">;</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="co">/**</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="co"> * </span><span class="an">@author</span> leek</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> A class is transformable if it can produce a copy of</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> itself in the transformed space using the supplied transform<span class="co">.</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> </span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> Note that a class may require either a Transform or an InvertibleTransform</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> depending on whether the strategy is to transform coordinates in the</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> source space into the destination space or to generate the object in</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> the destination space by sampling invert<span class="co">-</span>transformed points in the</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> source space<span class="co">.</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a> <span class="co">*</span> </span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a> <span class="co">*/</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> Transformable<span class="op">&lt;</span>O<span class="op">,</span>T <span class="kw">extends</span> <span class="bu">Transform</span><span class="op">&gt;</span> <span class="op">{</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>   <span class="co">/**</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span> Generate a copy of the object in the transformed space<span class="co">.</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span> <span class="an">@param</span><span class="co"> </span><span class="an">t</span><span class="co"> </span>the transform that maps points in the source space to those</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span>          in the destination space<span class="co">.</span></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">*</span> <span class="an">@return</span> a copy built to operate similarly in the transformed space<span class="co">.</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">*/</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>   <span class="kw">public</span> O <span class="fu">transform</span><span class="op">(</span><span class="dt">final</span> T t<span class="op">);</span></span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>You’d only want to implement Transformable in cases where the object has internal state which allows the transformed object to operate more efficiently than transformation of the object’s inputs, followed by application of the object’s function. For ROIs, the savings are clear - cost to transform a handful of vertices in a polygon versus cost of back-transforming millions of coordinates into the original space.</p>
<p>Now it obviously can be made to work for ROIs and it can be made to work to combine two linear transformations (dot product of matrices, right?). But other things are more complex and require more thought. At the end of it, each output is a function of the inputs and the trick is to composite a function that performs the operation. For a transform T1 to be transformable by transform T2, it seems that you need to combine and reduce an equation on the inputs of T1 for each of the outputs of T2. It’s a difficult enough problem that you might not want to make a transform generally transformable - you might want to have compositors with special knowledge regarding which classes can be combined to yield a new one and how it’s done.</p>
</section>
</section>
<section id="out-of-bounds-handling" class="level4">
<h4 class="anchored" data-anchor-id="out-of-bounds-handling">Out-Of-Bounds Handling</h4>
<p>In imglib2, out-of-bounds access is handled by <a href="https://fiji.sc/cgi-bin/gitweb.cgi?p=imglib.git;a=blob;f=imglib/src/main/java/mpicbg/imglib/ExtendedRandomAccessibleInterval.java;h=31dacac73d7c4377d2e2335681b3417e2c8665f4;hb=refs/heads/imglib2-dirty"><code>ExtendedRandomAccessibleInterval</code></a> If you have a <code>RandomAccessibleInterval</code> you can wrap it into an <code>ExtendedRandomAccessibleInterval</code> which extends to infinity. Like so:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>F interval<span class="op">;</span> <span class="co">// where F extends RandomAccessibleInterval&lt; T &gt;</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>OutOfBoundsFactory<span class="op">&lt;</span> T<span class="op">,</span> F <span class="op">&gt;</span> factory <span class="op">=</span> <span class="kw">new</span> OutOfBoundsMirrorFactory<span class="op">&lt;</span> T<span class="op">,</span> F <span class="op">&gt;(</span> OutOfBoundsMirrorFactory<span class="op">.</span><span class="fu">Boundary</span><span class="op">.</span><span class="fu">SINGLE</span> <span class="op">);</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>RandomAccessible<span class="op">&lt;</span> T <span class="op">&gt;</span> extended <span class="op">=</span> <span class="kw">new</span> ExtendedRandomAccessibleInterval<span class="op">&lt;</span> T <span class="op">&gt;(</span> randomAccessible<span class="op">,</span> factory <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>ExtendedRandomAccessibleInterval</code> is also a <code>RandomAccessibleView</code>. It might be inserted at any point in a view hierarchy. Here is an example:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>Img<span class="op">&lt;</span> FloatType <span class="op">&gt;</span> img <span class="op">=</span> LOCI<span class="op">.</span><span class="fu">openLOCIFloatType</span><span class="op">(</span><span class="kw">...</span><span class="op">);</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>RandomAccessibleView<span class="op">&lt;</span> FloatType <span class="op">&gt;</span> view1 <span class="op">=</span> Views<span class="op">.</span><span class="fu">extend</span><span class="op">(</span> img <span class="op">);</span>  </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>RandomAccessibleIntervalView<span class="op">&lt;</span> FloatType <span class="op">&gt;</span> view2 <span class="op">=</span> Views<span class="op">.</span><span class="fu">superIntervalView</span><span class="op">(</span> view1<span class="op">,</span> <span class="kw">new</span> <span class="dt">long</span><span class="op">[]</span> <span class="op">{-</span><span class="dv">20</span><span class="op">,</span> <span class="op">-</span><span class="dv">20</span><span class="op">},</span> <span class="kw">new</span> <span class="dt">long</span><span class="op">[]</span> <span class="op">{</span><span class="dv">157</span><span class="op">,</span> <span class="dv">157</span><span class="op">}</span> <span class="op">);</span>       </span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>RandomAccessibleView<span class="op">&lt;</span> FloatType <span class="op">&gt;</span>         view3 <span class="op">=</span> Views<span class="op">.</span><span class="fu">extend</span><span class="op">(</span> view2 <span class="op">);</span>    </span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>RandomAccessibleIntervalView<span class="op">&lt;</span> FloatType <span class="op">&gt;</span> view4 <span class="op">=</span> Views<span class="op">.</span><span class="fu">superIntervalView</span><span class="op">(</span> view3<span class="op">,</span> <span class="kw">new</span> <span class="dt">long</span><span class="op">[]</span> <span class="op">{-</span><span class="dv">100</span><span class="op">,</span> <span class="op">-</span><span class="dv">100</span><span class="op">},</span> <span class="kw">new</span> <span class="dt">long</span><span class="op">[]</span> <span class="op">{</span><span class="dv">357</span><span class="op">,</span> <span class="dv">357</span><span class="op">}</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The original <code>img</code> looks like this:</p>
<p><img src="../media/imglib2/imglib2views-img.png" class="img-fluid"></p>
<p>This is extended to infinity (using mirroring strategy) resulting in the unbounded <code>RandomAccessible view1</code>. A crop of <code>view1</code> looks like this:</p>
<p><img src="../media/imglib2/imglib2views-ext1.png" class="img-fluid"></p>
<p>Then we take a subview <code>view2</code> (which is again a bounded interval)</p>
<p><img src="../media/imglib2/imglib2views-extsub1.png" class="img-fluid"></p>
<p>We extend that to get <code>view3</code> and take a subview <code>view4</code> which looks like this:</p>
<p><img src="../media/imglib2/imglib2views-extsub1extsub2.png" class="img-fluid"></p>
<p>Now assume that we want <code>RandomAccess</code> into <code>view4</code>. If we know in advance interval in which we will use the access, <code>view4</code> can possibly provide more efficient access. Consider this:</p>
<p><img src="../media/imglib2/imglib2views-extsub1extsub2regions.png" class="img-fluid"></p>
<p>If we want to access only the green region, the <code>RandomAccess</code> can fall through all the way to the original <code>img</code> without needing out-of-bounds values. We simply wrap a <code>RandomAccess</code> on <code>img</code> with a coordinate translation to the top-left corner of <code>view4</code></p>
<p>If we need to access the red region, we wrap a out-of-bounds <code>RandomAccess</code> on <code>view1</code> (which wraps a <code>RandomAccess</code> on the <code>img</code>).</p>
<p>If we need to access the blue region, we wrap a out-of-bounds <code>RandomAccess</code> on <code>view3</code> (which wraps a out-of-bounds <code>RandomAccess</code> on <code>view1</code>, which which wraps a <code>RandomAccess</code> on the <code>img</code>).</p>
<p>A view hierarchy may consist of an arbitrary sequence of views that do coordinate transforms and extending views. Depending on interval we want to access, sometimes the extending views “disappear”. In this case, transforms before and after the extending view can be concatenated and simplified if possible.</p>
</section>
</section>
</section>
<section id="section-2" class="level2">
<h2 class="anchored" data-anchor-id="section-2">2011-03-24</h2>
<section id="transformation-hierarchies" class="level3">
<h3 class="anchored" data-anchor-id="transformation-hierarchies">Transformation Hierarchies</h3>
<p>{% include thumbnail src=‘/media/imglib2/imglib2-transform.png’ title=‘Simplified visualization of the hierarchy of ImgLib2 transforms that can be reduced by concatenation. Note that the interfaces responsible for concatenation are not implemented by the transform hierarchy. Necessary access to trivial parameters in specialized transforms is implemented just once in abstract classes.’%} We thought that it might at some point be useful to have a generic way of contracting chains of transforms. The idea is to have a hierarchy of transformations, i.e., a Translation is a Rigid transform is an Affine transform, etc. The hierarchy determines which transformations can be concatenated. It would be hard to concatenate transformations from different branches in the tree. For example, it is possible to concatenate a Translation and a Rotation to a Rigid transform. However, it is not clear whether we always want to do that. So we decided that transforms should be concatenable with their descendants in the hierarchy but not the other way around. That is, a Rigid can be concatenated with a Translation (resulting in another Rigid). But a Translation can not be concatenated with a Rigid (because this would not always result in another Translation).</p>
<p>Having a generic way of concatenating Rigid with all of its children means that all children must also be a Rigid. That is, we must be able to ask a Translation for its rotation matrix and so on. I was afraid, that this adds too much (implementation) overhead, but Stephan convinced me that this is the best way to go. Actually, it should be possible to make this relatively painless by having an hierarchy of abstract transform classes.</p>
<p>We settled on the following scheme for implementing the transformation hierarchy:</p>
<p>There are interfaces <code>Concatenable</code> and <code>PreConcatenable</code></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> Concatenable<span class="op">&lt;</span> A <span class="op">&gt;</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> Concatenable<span class="op">&lt;</span> A <span class="op">&gt;</span> <span class="fu">concatenate</span><span class="op">(</span> A a <span class="op">);</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">Class</span><span class="op">&lt;</span> A <span class="op">&gt;</span> <span class="fu">getConcatenableClass</span><span class="op">();</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>if <code>T</code> implements <code>Concatenable&lt; A &gt;</code> that means I can concatenate it with an <code>A</code>, usually resulting in another <code>T</code>.</p>
<p>The hierarchy of transforms is implemented by a hierarchy of interfaces. However these interfaces do <em>not</em> implement <code>Concatenable</code>. <code>Rigid</code> cannot be <code>Concatenable&lt; Rigid &gt;</code> because this would mean that <code>Translation</code> (which extends <code>Rigid</code>) must be concatenable with <code>Rigid</code> (resulting in another <code>Translation</code>).</p>
<p>Instead, both the <code>Rigid</code> and <code>Concatenable&lt; Rigid &gt;</code> interfaces are implemented by the <code>RigidTransform</code> class</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> RigidTransform <span class="kw">implements</span> Rigid<span class="op">,</span> Concatenable<span class="op">&lt;</span> Rigid <span class="op">&gt;</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> RigidTransform <span class="fu">concatenate</span><span class="op">(</span> Rigid a <span class="op">)</span> <span class="op">{</span><span class="kw">...</span><span class="op">}</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">Class</span><span class="op">&lt;</span> Rigid <span class="op">&gt;</span> <span class="fu">getConcatenableClass</span><span class="op">()</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Rigid<span class="op">.</span><span class="fu">class</span><span class="op">;</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Similarly we have</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> TranslationTransform <span class="kw">implements</span> Translation<span class="op">,</span> Concatenable<span class="op">&lt;</span> Translation <span class="op">&gt;</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> TranslationTransform <span class="fu">concatenate</span><span class="op">(</span> Translation a <span class="op">)</span> <span class="op">{</span><span class="kw">...</span><span class="op">}</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="bu">Class</span><span class="op">&lt;</span> Translation <span class="op">&gt;</span> <span class="fu">getConcatenableClass</span><span class="op">()</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> Translation<span class="op">.</span><span class="fu">class</span><span class="op">;</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note, that <code>TranslationTransform</code> cannot extend <code>RigidTransform</code> (because otherwise it would inherit <code>Concatenable&lt; Rigid &gt;</code>.)</p>
<p>We add an abstract class hierarchy between the interfaces and the transform classes. The abstract classes do not implement <code>Concatenable</code>, so at this level extension is still possible.</p>
</section>
</section>
<section id="section-3" class="level2">
<h2 class="anchored" data-anchor-id="section-3">2011-03-25</h2>
<section id="get-and-set-strategy-for-different-dimensionalities" class="level3">
<h3 class="anchored" data-anchor-id="get-and-set-strategy-for-different-dimensionalities">Get and Set Strategy for different dimensionalities</h3>
<p>If one wants to work with images that have different dimensionalities (e.g.&nbsp;2d and 3d), it should be clearly defined how ImgLib handles Positionables, Localizables and location arrays.</p>
<p>getPosition calls: ImgLib will always iterate over the dimensionality of the Cursor which is queried for its position, i.e.&nbsp;one can always pass an array with a higher dimensionality and it will only set the lower dimensionality entries.</p>
<p>setPosition calls: ImgLib will always iterate over the dimensionality of the array that indicates the new location, i.e.&nbsp;one can pass an array or Localizable with a lower dimensionality and it will only set the new position in those lower dimensions.</p>
<p>For example 2d/3d:</p>
<pre><code>Localizable2d.localize( array[3] ) - OK
Localizable3d.localize( array[2] ) - NOT OK
  
Positionable2d.setPostion( array[3] ) - NOT OK
Positionable3d.setPostion( array[2] ) - OK</code></pre>
<p>We discussed this topic again and found that it is always bad practice to actually work with dimension vectors of different sizes. Instead, one should use views that map into a common <em>n</em>-space by either adding or removing a set of dimensions in one or both of the RandomAccessibles. Still, the behavior needs to be specified strictly. With an eye on efficiency and consistency, we revert our previous opinion to</p>
<pre><code>Localizable2d.localize( array[3] ) - OK
Localizable3d.localize( array[2] ) - NOT OK
  
Positionable2d.setPostion( array[3] ) - OK
Positionable3d.setPostion( array[2] ) - NOT OK
Positionable2d.setPostion( Localizable3d ) - OK
Positionable3d.setPostion( Localizable2d ) - NOT OK</code></pre>
<p>for the reason that in the latter case, the loop would require Localizable.numDimensions() to be called otherwise. There will be many situations where this cannot be inlined and thus be slower than using a temporary <em>n</em> in the executing class.</p>
</section>
</section>
<section id="section-4" class="level2">
<h2 class="anchored" data-anchor-id="section-4">2011-05-02</h2>
<section id="we-discussed-the-extendedrandomaccessibleinterval" class="level3">
<h3 class="anchored" data-anchor-id="we-discussed-the-extendedrandomaccessibleinterval">We discussed the ExtendedRandomAccessibleInterval:</h3>
<p>Tobias and Preibisch discussed today that the name <code>ExtendedRandomAccessibleInterval</code> is somehow irritating and also to long as it will be heavily used for <code>OutOfBounds</code> strategies.</p>
<p>It is irritating as it is actually NOT an Interval. Instead one could name it for example <code>OutOfBoundsView</code>, which is also much shorter. It is only used for this purpose and the name is self-explanatory.</p>
<p>We also added some convenience methods in the Views class to construct them very easily, see here: <a href="../imglib2/changes-from-imglib1#how-does-imglib2-handle-outofbounds">How does ImgLib2 handle OutOfBounds?</a></p>
</section>
<section id="should-iterator-and-so-cursor-have-a-bck-call" class="level3">
<h3 class="anchored" data-anchor-id="should-iterator-and-so-cursor-have-a-bck-call">Should Iterator (and so Cursor) have a bck() call?</h3>
<p>We have been discussing this several times with a two-folded answer:</p>
<ol type="1">
<li>Yes, because iteration order for ImgLib2 Iterators is claimed to be constant. Given that, accessing the previous element (<code>bck()</code>) call is always defined.</li>
<li>No, because it would require a substantial extension of the existing interfaces and classes. ImgLib2 Iterator could then implement ListIterator which is a lot of effort to implement.</li>
</ol>
<p>In principal, I strongly support introducing it. It makes total sense but it is a change in the core. {% include person id=‘axtimwalde’ %} 17:03, 3 May 2011 (CEST)</p>
<p>I discussed it again with Tobias yesterday in detail and we came to the conclusion that it does not make too much sense. First of all, any Sampler can be copied at a certain location now, i.e.&nbsp;wait there. And it is also important to consider that going back would have a different logic than going forward as Cursors might crash when moved out. This means one would not be able to access +1, but one has to start at the last pixel of the e.g.&nbsp;<code>Img&lt;T&gt;</code>. That means when iterating back, the test has to be different: First get value, then move.</p>
<p>So maybe we just skip it? However, we could have an Interface that provides this functionality:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bck</span><span class="op">();</span> <span class="fu">hasPrevious</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>just for the case that somebody wants to implement it for some reason and does not has to do its own interface which would be incompatible with other people who would want to it. Could be named ReverseCursor or so… {% include person id=‘StephanPreibisch’ %} 12:24, 4 May 2011 (CEST)</p>
</section>
</section>
<section id="section-5" class="level2">
<h2 class="anchored" data-anchor-id="section-5">2011-05-04</h2>
<section id="localizable-and-reallocalizable-interface-get-methods" class="level3">
<h3 class="anchored" data-anchor-id="localizable-and-reallocalizable-interface-get-methods">Localizable and RealLocalizable Interface get()-methods</h3>
<p>I noticed today that those two interfaces still have methods which are called <code>getIntPostion()</code>, <code>getLongPosition()</code> and so on which is different to the new naming scheme that is much better and shorter:</p>
<pre><code>- numDimensions instead of `getNumDimensions()`

- localize instead of `getLocation()`</code></pre>
<p>etc…</p>
<p>should we maybe change it as well to <code>intPosition()</code>, <code>longPosition</code>, etc?</p>
<p>{% include person id=‘StephanPreibisch’ %} 12:24, 4 May 2011 (CEST)</p>
<p>Tobias pointed out that we should not as it is not clear if it is a getter or setter when passing an array.</p>
</section>
</section>
<section id="section-6" class="level2">
<h2 class="anchored" data-anchor-id="section-6">2011-05-12</h2>
<section id="positionables" class="level3">
<h3 class="anchored" data-anchor-id="positionables">Positionables</h3>
<p>Should we maybe have fast setPosition-calls for dimension 0?</p>
<p>In many algorithms we will need 1-dimensional <code>Img&lt;T&gt;</code>, like Histograms, Gauss and many more. A fast <code>setPositionDim0(position)</code> could be quite some speedup for arrays as</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">setPosition</span><span class="op">(</span> <span class="dt">final</span> <span class="dt">int</span> pos<span class="op">,</span> <span class="dt">final</span> <span class="dt">int</span> dim <span class="op">)</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>    type<span class="op">.</span><span class="fu">incIndex</span><span class="op">(</span> <span class="op">(</span> pos <span class="op">-</span> position<span class="op">[</span> dim <span class="op">]</span> <span class="op">)</span> <span class="op">*</span> container<span class="op">.</span><span class="fu">steps</span><span class="op">[</span> dim <span class="op">]</span> <span class="op">);</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>    position<span class="op">[</span> dim <span class="op">]</span> <span class="op">=</span> pos<span class="op">;</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>could simply become</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">setPositionDim0</span><span class="op">(</span> <span class="dt">final</span> <span class="dt">int</span> pos <span class="op">)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>    type<span class="op">.</span><span class="fu">incIndex</span><span class="op">(</span> pos <span class="op">-</span> position<span class="op">[</span> <span class="dv">0</span> <span class="op">]</span> <span class="op">);</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>    position<span class="op">[</span> <span class="dv">0</span> <span class="op">]</span> <span class="op">=</span> pos<span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>which saves a multiplication for many operations. It can also not be inlined by the JIT compiler as <code>container.steps[ 0 ]</code> cannot be made final, it could potentially always be changed…</p>
<p>The same applies for <code>fwd(dim)</code>, <code>bck(dim)</code>, <code>move(dim)</code>, there a <code>--</code> <code>++</code> and <code>+=</code> can replace a array lookup…</p>
<p>{% include person id=‘StephanPreibisch’ %} 12:27, 12 May 2011 (CEST)</p>
<p>What about having a 1D <code>RandomAccess</code> instead as we have done in <code>PlanarImg</code> for <code>Cursor</code>. That could implement the <code>setPosition(long p, int d)</code> method ignoring <code>d</code>. A 1D <code>RandomAccess</code> could, in addition, have the proposed method such that in situations where you know what you’re doing (read: where you can cast), you have a shorter call available. That approach would also relieve us from the need to implement that method in situations where it does not make sense at all, e.g.&nbsp;<code>ShapeImg</code>, that has no 1D. {% include person id=‘axtimwalde’ %} 15:27, 12 May 2011 (CEST)</p>
<p>I like this way of realizing it, maybe we could also implement it on ImgFactory level. If a Img implements RandomAccessible1D, the factory could also have a special create( long size ) method (in e.g.&nbsp;RandomAccessible1DFactory) which returns for example &lt;I extends ArrayImg&lt;T,?&gt; &amp; RandomAccessible1D&gt;, so no unchecked casts are necessary. {% include person id=‘StephanPreibisch’ %} 16:15, 12 May 2011 (CEST)</p>
</section>
</section>
<section id="section-7" class="level2">
<h2 class="anchored" data-anchor-id="section-7">2011-11-28</h2>
<section id="realviews" class="level3">
<h3 class="anchored" data-anchor-id="realviews">RealViews</h3>
<p>Johannes pointed out that we will need to be able to handle images of different calibrations, e.g., compute the sum of two images with different pixel sizes.</p>
<p>I think, what we need to achieve this is something similar to what we have with the (integer) Views now. I will call them “RealViews” for now, and hope that someone comes up with a better name…</p>
<p>A RealView would implement (in analogy to the integer views)</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">interface</span> RealTransformedRealRandomAccessible<span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="kw">extends</span> RealRandomAccessible<span class="op">&lt;</span> T <span class="op">&gt;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@return</span> the source <span class="an">{@link</span> RealRandomAccessible<span class="an">}</span><span class="co">.</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> RealRandomAccessible<span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="fu">getSource</span><span class="op">();</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>    <span class="co">/**</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">     * </span><span class="an">@return</span> transformation from view coordinates into <span class="an">{@link</span> <span class="an">#</span>getSource<span class="an">()</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>     <span class="an">*</span>         source<span class="an">}</span> coordinates<span class="co">.</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>     <span class="co">*/</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> RealTransform <span class="fu">getTransformToSource</span><span class="op">();</span>    </span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note, that <code>RealTransform</code> implementations do not yet exist. However the ideas are in place, see <a href="https://fiji.sc/wiki/index.php/ImgLib2_Discussion#transformation-hierarchies">Transformation Hierarchies</a> above. The interfaces to be implemented can be found in packages <code>net.imglib2.concatenate</code> and <code>net.imglib2.transform</code>.</p>
<p>Examples of implementation of the integer version of these interfaces can be found in <code>net.imglib2.transform.integer</code> (These are the ones I did for views).</p>
<section id="interpolated-realrandomaccessible" class="level4">
<h4 class="anchored" data-anchor-id="interpolated-realrandomaccessible">Interpolated RealRandomAccessible</h4>
<p>As the source for a RealView we need a <code>RealRandomAccessible</code>. This will be most likely a interpolated image. In <code>net.imglib.interpolation</code> we have <code>InterpolatorFactories</code> implementing nearest-neighbor and n-linear interpolation. What is left to do is write a (trivial) wrapper which turns a <code>RandomAccessible</code> into a <code>RealRandomAccessible</code> using an <code>InterpolatorFactory</code>. It would look more or less exactly like this:</p>
<pre><code>public final class InterpolatedRandomAccessible&lt; T &gt; implements RealRandomAccessible&lt; T &gt;
{
    private final RandomAccessible&lt; T &gt; source;
    
    private final InterpolatorFactory&lt; T, RandomAccessible&lt; T &gt; &gt; factory;
    
    public InterpolatedRandomAccessible( final RandomAccessible&lt; T &gt; source, final InterpolatorFactory&lt; T, RandomAccessible&lt; T &gt; &gt; factory )
    {
        this.source = source;
        this.factory = factory;
    }

    @Override
    public int numDimensions()
    {
        return source.numDimensions();
    }

    @Override
    public RealRandomAccess&lt; T &gt; realRandomAccess()
    {
        return factory.create( source );
    } 
}
</code></pre>
</section>
<section id="using-realviews" class="level4">
<h4 class="anchored" data-anchor-id="using-realviews">Using RealViews</h4>
<p>Similar to what is now in <code>Views</code> there would be static methods to construct views, for example construct a RealView given a source RandomAccessible as well as source and target calibration.</p>
<p>One would wrap all of the source images into <code>InterpolatedRandomAccessible</code> and use RealViews as required to match the calibration of the target image. Then to carry out some operation, one would iterate through the target image and fetch the (possibly interpolated) values from the corresponding locations in the respective source views.</p>
</section>
</section>
</section>
<section id="section-8" class="level2">
<h2 class="anchored" data-anchor-id="section-8">2012-01-28</h2>
<p>We have discussed with Tobias that two additional integer views would be very helpful:</p>
<ol type="1">
<li>Joining multiple images of the same size and dimensions into one or more dimensions of a single image (composition as opposed to decomposition which is implemented by hyperslice views).</li>
<li>Adding a new dimension considering an existing dimension as interleaved data.</li>
</ol>
<p>When done properly this has the potential to replace or at least simplify PlanarImg like containers since they could be expressed as a composition of multiple ArrayImg-s. {% include person id=‘axtimwalde’ %} 16:11, 18 January 2012 (CET)</p>
</section>
<section id="section-9" class="level2">
<h2 class="anchored" data-anchor-id="section-9">2012-11-21</h2>
<p>Another useful integer view comes to mind:</p>
<ol type="1">
<li>Stack two images with all dimensions <em>d</em> &lt; <em>n</em>-1 in the (<em>n</em>-1)<sup>th</sup> dimension. That would enable to load an image piecewise or to grow a time sequence <em>etc.</em></li>
</ol>
<p>The stack view is a special form of a `composite’ view (do not confuse with dimensional composition as mentioned above—clarify terminology!) that consists of two <code>RandomAccessible&lt;T&gt;</code> or <code>RandomAccessibleInterval&lt;T&gt;</code> that combine their values following some composition rule. Examples:</p>
<ol type="1">
<li>a stack of images</li>
<li>two images overlaid on top of each other</li>
<li>an image that includes another image at a specified location</li>
</ol>
<p>…</p>
<p>For those that are familiar with it, AWT has the <code>Composite</code> interface to specify the pixel operation for combining two rasters (such as copy, add, multiply, alpha, <em>etc.</em>). TrakEM2 is another good example from the Fiji universe. It represents 3D images that are a stack of 2D images that are composites of transformed 2D images or 2D projections of 3D images.</p>
<p>For ImgLib2, we could have the composition principle generalized and provide some special purpose implementations (stacking, AWT raster composition, TrakEM2-alike images).</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/imglib\.github\.io\/imglib2-www");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>
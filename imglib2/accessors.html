<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ImgLib2 and BigDataviewer projects - ImgLib2 - Accessors</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
<meta property="og:title" content="ImgLib2 and BigDataviewer projects - ImgLib2 - Accessors">
<meta property="og:description" content="">
<meta property="og:site_name" content="ImgLib2 and BigDataviewer projects">
</head>

<body class="nav-sidebar floating nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ImgLib2 and BigDataviewer projects</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../imglib2.html"> 
<span class="menu-text">ImgLib2</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../BDV.html"> 
<span class="menu-text">BDV</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-resources" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Resources</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-resources">    
        <li>
    <a class="dropdown-item" href="../resources/imglib2_links.html"><i class="bi bi-info-square" role="img">
</i> 
 <span class="dropdown-text">ImgLib2 links</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../resources/bigdataviewer_links.html"><i class="bi bi-info-square" role="img">
</i> 
 <span class="dropdown-text">BigDataViewer links</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/imglib"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">ImgLib2 github</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://github.com/bigdataviewer"><i class="bi bi-github" role="img">
</i> 
 <span class="dropdown-text">BigDataViewer github</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="../ecosystem.html"> 
<span class="menu-text">Ecosystem</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-contributing-guidelines" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Contributing Guidelines</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-contributing-guidelines">    
        <li>
    <a class="dropdown-item" href="../contribute/guidelines_for_imglib2.html"><i class="bi bi-share" role="img">
</i> 
 <span class="dropdown-text">Guidelines for ImgLib2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contribute/guidelines_for_bigdataviewer.html"><i class="bi bi-share" role="img">
</i> 
 <span class="dropdown-text">Guidelines for BigDataViewer</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../contribute/our_code_of_conduct.html"><i class="bi bi-peace" role="img">
</i> 
 <span class="dropdown-text">Our Code-of-conduct</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@imglib2"> <i class="bi bi-mastodon" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item">ImgLib2 - Accessors</li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
        <div class="sidebar-tools-main">
    <a href="https://github.com/imglib/imglib2" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">ImgLib2</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">ImgLib 'Deprecated' </span></span>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">ImgLib2 - Accessors</h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/imglib/imglib2-www/blob/main/imglib2/accessors.md"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>In ImgLib2, images are manipulated using <em>Accessors</em>. For pixel images, you can think of an accessor as a movable reference to a pixel.</p>
<ul>
<li>You can move it around the image (for example make it reference a pixel at specific coordinates).</li>
<li>You can de-reference it to get the pixel value.</li>
<li>And of course, you can ask its current position.</li>
</ul>
<p>The accessors provided by ImgLib2 typically implement <code>Cursor</code> or <code>RandomAccess</code>. <code>Cursor</code> and <code>RandomAccess</code> are aggregations of interfaces covering the above three points. A simplified UML diagram for the interface hierarchy is shown below. (The simplification is with respect to real-coordinate interfaces for continuous images that are left out for now.)</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/libs/imglib2/imglib2-accessors-simplified-integer.png" class="img-fluid figure-img"></p>
<figcaption>“imglib2-accessors-simplified-integer”</figcaption>
</figure>
</div>
<p>ImgLib2 supports two basic access patterns:</p>
<ul>
<li><a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RandomAccess.html">RandomAccess</a> provides n-dimensional random access through the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Positionable.html">Positionable</a> interface. It can be positioned at arbitrary integer coordinates.</li>
<li><a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Cursor.html">Cursor</a> provides iteration through the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Iterator.html">Iterator</a> interface. It can be moved forward to visit all pixels of the image once.</li>
</ul>
<p>Both, <code>RandomAccess</code> and <code>Cursor</code> implement the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Sampler.html">Sampler</a> interface which allows to access pixel values. Both implement the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Localizable.html">Localizable</a> interface which allows to retrieve the accessors current pixel coordinates. Both inherit (through <code>Localizable</code>) the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/EuclideanSpace.html">EuclideanSpace</a> interval which allows to get the number of dimensions of the image.</p>
<p>Note, that <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Sampler.html">Sampler</a>, <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RandomAccess.html">RandomAccess</a>, and <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Cursor.html">Cursor</a> have a type paramer <code>&lt;T&gt;</code> that refers to the value type of the underlying image.</p>
</section>
<section id="randomaccess" class="level2">
<h2 class="anchored" data-anchor-id="randomaccess">RandomAccess</h2>
<p><a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RandomAccess.html">RandomAccess</a> provides n-dimensional random access through the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Positionable.html">Positionable</a> interface. It can be used to access pixels at arbitrary integer coordinates. The following code uses a <code>RandomAccess</code> to draw some white pixels into an image.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Random</span><span class="op">;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">RandomAccess</span><span class="op">;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">Img</span><span class="op">;</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">array</span><span class="op">.</span><span class="im">ArrayImgFactory</span><span class="op">;</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">display</span><span class="op">.</span><span class="im">imagej</span><span class="op">.</span><span class="im">ImageJFunctions</span><span class="op">;</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">numeric</span><span class="op">.</span><span class="im">integer</span><span class="op">.</span><span class="im">UnsignedByteType</span><span class="op">;</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> DrawWhitePixels</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span> <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> args <span class="op">)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">int</span><span class="op">[]</span> dimensions <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[]</span> <span class="op">{</span> <span class="dv">400</span><span class="op">,</span> <span class="dv">320</span> <span class="op">};</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> Img<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> img <span class="op">=</span> <span class="kw">new</span> ArrayImgFactory<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;()</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">create</span><span class="op">(</span> dimensions<span class="op">,</span> <span class="kw">new</span> <span class="fu">UnsignedByteType</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">RandomAccess</span><span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> r <span class="op">=</span> img<span class="op">.</span><span class="fu">randomAccess</span><span class="op">();</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">Random</span> random <span class="op">=</span> <span class="kw">new</span> <span class="bu">Random</span><span class="op">();</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> <span class="op">++</span>i <span class="op">)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> <span class="dt">int</span> x <span class="op">=</span> <span class="op">(</span> <span class="dt">int</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> <span class="dv">0</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> <span class="dt">int</span> y <span class="op">=</span> <span class="op">(</span> <span class="dt">int</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> <span class="dv">1</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>            r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> x<span class="op">,</span> <span class="dv">0</span> <span class="op">);</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>            r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> y<span class="op">,</span> <span class="dv">1</span> <span class="op">);</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> UnsignedByteType t <span class="op">=</span> r<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>            t<span class="op">.</span><span class="fu">set</span><span class="op">(</span> <span class="dv">255</span> <span class="op">);</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>        ImageJFunctions<span class="op">.</span><span class="fu">show</span><span class="op">(</span> img <span class="op">);</span></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In lines <em>013-015</em> we create a 8-bit gray-level image, in line <em>029</em> we show the result (like in the <a href="../imglib2/getting-started.html#opening-and-displaying-image-files">previous example</a>).</p>
<p>In line <em>017</em> we create a <code>RandomAccess</code> to the image. <code>Img</code> implements the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RandomAccessible.html">RandomAccessible</a> interface, thus we can use <code>randomAccess()</code> to obtain one. The <code>RandomAccess</code> has the same generic type, <code>UnsignedByteType</code>, as the image.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="bu">RandomAccess</span><span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> r <span class="op">=</span> img<span class="op">.</span><span class="fu">randomAccess</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In the <code>for</code> loop (lines <em>019-027</em>) we set 1000 random pixels to the value 255 (white). First we obtain the <em>x</em>, <em>y</em> coordinates of a random pixel within the image boundaries.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="dt">int</span> x <span class="op">=</span> <span class="op">(</span> <span class="dt">int</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> <span class="dv">0</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="dt">int</span> y <span class="op">=</span> <span class="op">(</span> <span class="dt">int</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> <span class="dv">1</span> <span class="op">)</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then we position the <code>RandomAccess</code> at those coordinates.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> x<span class="op">,</span> <span class="dv">0</span> <span class="op">);</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> y<span class="op">,</span> <span class="dv">1</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The <code>setPosition()</code> method (from the <code>Positionable</code> interface) takes two parameters: the coordinate and the dimension. So we set the coordinate in dimension 0 to the value <em>x</em>, and we set the coordinate in dimension 1 to the value <em>y</em>.</p>
<p>After the <code>RandomAccess</code> has been positioned correctly, we can <code>get()</code> the pixel at that coordinate.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> UnsignedByteType t <span class="op">=</span> r<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We get an instance of the pixel value type <code>UnsignedByteType</code> that acts as a reference to the pixel. We set the pixel value via this reference</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>t<span class="op">.</span><span class="fu">set</span><span class="op">(</span> <span class="dv">255</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="notes" class="level3">
<h3 class="anchored" data-anchor-id="notes">Notes</h3>
<ul>
<li><code>get()</code> is defined in the <code>Sampler</code> interface, so you can obtain pixel references from a <code>Cursor</code> in exactly the same way.</li>
<li>Often, the <code>T</code> obtained from <code>Sampler&lt;T&gt;.get()</code> is a proxy object that is re-used internally. You should assume that moving the accessor invalidates the proxy. If you want to keep a permanent reference to a pixel, use the <code>Sampler&lt;T&gt;.copy()</code> method. In the above example, this would return a copy of the RandomAccess refering to the same pixel.</li>
<li>The <code>Positionable</code>, <code>Localizable</code>, … interfaces are not restricted to accessors. In fact, many ImgLib2 entities are <code>Localizable</code>. For instance, the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Point.html">Point</a> class implements <code>Positionable</code> and <code>Localizable</code>, and simply represents a n-dimensional coordinate. In your own code, whenever you have something that can provide coordinates, you should consider implementing <code>Localizable</code>.</li>
</ul>
</section>
</section>
<section id="a-taste-of-generic-algorithms" class="level2">
<h2 class="anchored" data-anchor-id="a-taste-of-generic-algorithms">A Taste of Generic Algorithms</h2>
<p>Before we move on to the “other” accessor, <em>Cursor</em>, let’s consider a generalization of the previous example. Let’s say we like setting random pixels, and because we plan to do this a lot in the future, we extract this functionality into a method.</p>
<p>Easy enough. But what if we want to apply the method to images of another value type, e.g.&nbsp;<code>DoubleType</code> or <code>ARGBType</code>? What if we want to apply it to a 3D image? ImgLib2 allows you to write code that handles of this transparently. In the following we write a function, that sets 1000 random pixels to “white”, no matter what.</p>
<p>Let’s take it step by step, starting from the original non-generic version. First, we extract a set-1000-pixels method for 2D <code>Img&lt;UnsignedByteType&gt;</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">draw</span><span class="op">(</span> <span class="dt">final</span> Img<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> img <span class="op">)</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">RandomAccess</span><span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> r <span class="op">=</span> img<span class="op">.</span><span class="fu">randomAccess</span><span class="op">();</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">Random</span> random <span class="op">=</span> <span class="kw">new</span> <span class="bu">Random</span><span class="op">();</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> <span class="op">++</span>i <span class="op">)</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">int</span> x <span class="op">=</span> <span class="op">(</span> <span class="dt">int</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> <span class="dv">0</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">int</span> y <span class="op">=</span> <span class="op">(</span> <span class="dt">int</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> <span class="dv">1</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> x<span class="op">,</span> <span class="dv">0</span> <span class="op">);</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> y<span class="op">,</span> <span class="dv">1</span> <span class="op">);</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> UnsignedByteType t <span class="op">=</span> r<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>        t<span class="op">.</span><span class="fu">set</span><span class="op">(</span> <span class="dv">255</span> <span class="op">);</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We can add a generic parameter to the method handle arbitrary value types <code>T</code>. We want something like</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="dt">void</span> <span class="fu">draw</span><span class="op">(</span> <span class="dt">final</span> Img<span class="op">&lt;</span> T <span class="op">&gt;</span> img <span class="op">)</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="kw">...</span> <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However, for a generic <code>T</code>, we no longer know what “white” is. 255 will certainly not do. So we need to pass the “white” value into the method.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="dt">void</span> <span class="fu">draw</span><span class="op">(</span> <span class="dt">final</span> Img<span class="op">&lt;</span> T <span class="op">&gt;</span> img<span class="op">,</span> <span class="dt">final</span> T white <span class="op">)</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="kw">...</span> <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Furthermore, we need a way to set a pixel to this value. Note, that the <code>Sampler.get()</code> method provides a <em>reference</em> to the pixel. Changing that reference won’t do any good, and there is no <code>Sampler.set()</code> method! We need to ensure that we can use the reference to change the pixel value.</p>
<p>At the root of the ImgLib2 type hierarchy lies <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Type.html">Type</a>. A type <code>T</code> extending <code>Type&lt;T&gt;</code> must have a <code>set( T )</code> method, which is exactly what we need. So we make our method only accept those <code>T</code>’s.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span> T <span class="kw">extends</span> <span class="bu">Type</span><span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="op">&gt;</span> <span class="dt">void</span> <span class="fu">draw</span><span class="op">(</span> <span class="dt">final</span> Img<span class="op">&lt;</span> T <span class="op">&gt;</span> img<span class="op">,</span> <span class="dt">final</span> T white <span class="op">)</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="kw">...</span> <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Replacing the <code>UnsignedByteType</code> with the generic <code>T</code>, and using <code>white</code> instead of 255, we obtain a more general version of <code>draw()</code>.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> DrawWhitePixelsGeneric</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span> T <span class="kw">extends</span> <span class="bu">Type</span><span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="op">&gt;</span> <span class="dt">void</span> <span class="fu">draw</span><span class="op">(</span> <span class="dt">final</span> Img<span class="op">&lt;</span> T <span class="op">&gt;</span> img<span class="op">,</span> <span class="dt">final</span> T white <span class="op">)</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">RandomAccess</span><span class="op">&lt;</span> T <span class="op">&gt;</span> r <span class="op">=</span> img<span class="op">.</span><span class="fu">randomAccess</span><span class="op">();</span></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">Random</span> random <span class="op">=</span> <span class="kw">new</span> <span class="bu">Random</span><span class="op">();</span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> <span class="op">++</span>i <span class="op">)</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> <span class="dt">int</span> x <span class="op">=</span> <span class="op">(</span> <span class="dt">int</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> <span class="dv">0</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> <span class="dt">int</span> y <span class="op">=</span> <span class="op">(</span> <span class="dt">int</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> <span class="dv">1</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>            r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> x<span class="op">,</span> <span class="dv">0</span> <span class="op">);</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>            r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> y<span class="op">,</span> <span class="dv">1</span> <span class="op">);</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> T t <span class="op">=</span> r<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>            t<span class="op">.</span><span class="fu">set</span><span class="op">(</span> white <span class="op">);</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-18"><a href="#cb11-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span> <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> args <span class="op">)</span></span>
<span id="cb11-19"><a href="#cb11-19" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb11-20"><a href="#cb11-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">int</span><span class="op">[]</span> dimensions <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[]</span> <span class="op">{</span> <span class="dv">400</span><span class="op">,</span> <span class="dv">320</span> <span class="op">};</span></span>
<span id="cb11-21"><a href="#cb11-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> Img<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> img <span class="op">=</span> <span class="kw">new</span> ArrayImgFactory<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;()</span></span>
<span id="cb11-22"><a href="#cb11-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">create</span><span class="op">(</span> dimensions<span class="op">,</span> <span class="kw">new</span> <span class="fu">UnsignedByteType</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb11-23"><a href="#cb11-23" aria-hidden="true" tabindex="-1"></a>        <span class="fu">draw</span><span class="op">(</span> img<span class="op">,</span> <span class="kw">new</span> <span class="fu">UnsignedByteType</span><span class="op">(</span> <span class="dv">255</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb11-24"><a href="#cb11-24" aria-hidden="true" tabindex="-1"></a>        ImageJFunctions<span class="op">.</span><span class="fu">show</span><span class="op">(</span> img <span class="op">);</span></span>
<span id="cb11-25"><a href="#cb11-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb11-26"><a href="#cb11-26" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Note, that we have to pass <code>new UnsignedByteType( 255 )</code> when calling <code>draw()</code>.</p>
<p>Next, lets think about dimensionality independence. Instead of <code>setPosition()</code> for just dimensions 0 and 1, we can do so for as many dimensions as the image happens to have. We get the number of dimensions using</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="dt">int</span> n <span class="op">=</span> img<span class="op">.</span><span class="fu">numDimensions</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>(<code>Img</code> also extends <code>EuclideanSpace</code>).</p>
<p>We loop over all dimensions when setting the position of the <code>RandomAccess</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> d <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> d <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>d <span class="op">)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">int</span> x <span class="op">=</span> <span class="op">(</span> <span class="dt">int</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> d <span class="op">)</span> <span class="op">);</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> x<span class="op">,</span> d <span class="op">);</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Setting the position dimension-by-dimension may be inefficient, because the <code>RandomAccess</code> might need to modify internal state with each <code>setPosition()</code> call. Instead, we may pass a <code>int[]</code> or <code>long[]</code> array comprising the coordinates to set the position at once.</p>
<p>Now the method looks like this:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span> T <span class="kw">extends</span> <span class="bu">Type</span><span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="op">&gt;</span> <span class="dt">void</span> <span class="fu">draw</span><span class="op">(</span> <span class="dt">final</span> Img<span class="op">&lt;</span> T <span class="op">&gt;</span> img<span class="op">,</span> <span class="dt">final</span> T white <span class="op">)</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">int</span> n <span class="op">=</span> img<span class="op">.</span><span class="fu">numDimensions</span><span class="op">();</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="dt">long</span><span class="op">[]</span> pos <span class="op">=</span> <span class="kw">new</span> <span class="dt">long</span><span class="op">[</span> n <span class="op">];</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">RandomAccess</span><span class="op">&lt;</span> T <span class="op">&gt;</span> r <span class="op">=</span> img<span class="op">.</span><span class="fu">randomAccess</span><span class="op">();</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> <span class="bu">Random</span> random <span class="op">=</span> <span class="kw">new</span> <span class="bu">Random</span><span class="op">();</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> <span class="op">++</span>i <span class="op">)</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> d <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> d <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>d <span class="op">)</span></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>            pos<span class="op">[</span> d <span class="op">]</span> <span class="op">=</span> <span class="op">(</span> <span class="dt">int</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> d <span class="op">)</span> <span class="op">);</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>        r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> pos <span class="op">);</span></span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> T t <span class="op">=</span> r<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>        t<span class="op">.</span><span class="fu">set</span><span class="op">(</span> white <span class="op">);</span></span>
<span id="cb14-15"><a href="#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb14-16"><a href="#cb14-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, there is no need to restrict ourselves to <code>Img</code>. After all, we do not need many of the features of <code>Img</code>. We need be able to get a <code>RandomAccess</code>, so we need <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RandomAccessible.html">RandomAccessible&lt;T&gt;</a>. We need to be able to get the number of dimensions and the extent in every dimension, so we need <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Interval.html">Interval</a>. These two are conveniently gathered in <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RandomAccessibleInterval.html">RandomAccessibleInterval&lt;T&gt;</a>. So lets make that</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span> T <span class="kw">extends</span> <span class="bu">Type</span><span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="op">&gt;</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">void</span> <span class="fu">draw</span><span class="op">(</span> <span class="dt">final</span> RandomAccessibleInterval<span class="op">&lt;</span> T <span class="op">&gt;</span> img<span class="op">,</span> <span class="dt">final</span> T white <span class="op">)</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="kw">...</span> <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Now we are able to apply <code>draw()</code> to many ImgLib2 constructs that are not pixel <code>Img</code>s. For instance there are Views that employ on-the-fly coordinate transforms, sampled and interpolated data, etc.</p>
<p>However, with great power comes great responsibility… Taking a general <code>Interval</code> means that we no longer can assume that the interval starts at coordinates <em>(0,0,…,0)</em>. Thus we need to make a final modification to correctly draw between <em>min</em> and <em>max</em> of the interval.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Random</span><span class="op">;</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">RandomAccess</span><span class="op">;</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">RandomAccessibleInterval</span><span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">Img</span><span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">array</span><span class="op">.</span><span class="im">ArrayImgFactory</span><span class="op">;</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">display</span><span class="op">.</span><span class="im">imagej</span><span class="op">.</span><span class="im">ImageJFunctions</span><span class="op">;</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">Type</span><span class="op">;</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">numeric</span><span class="op">.</span><span class="im">ARGBType</span><span class="op">;</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">numeric</span><span class="op">.</span><span class="im">integer</span><span class="op">.</span><span class="im">IntType</span><span class="op">;</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">numeric</span><span class="op">.</span><span class="im">integer</span><span class="op">.</span><span class="im">UnsignedByteType</span><span class="op">;</span></span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> DrawWhitePixelsGeneric</span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span> T <span class="kw">extends</span> <span class="bu">Type</span><span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="op">&gt;</span></span>
<span id="cb16-16"><a href="#cb16-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">void</span> <span class="fu">draw</span><span class="op">(</span> <span class="dt">final</span> RandomAccessibleInterval<span class="op">&lt;</span> T <span class="op">&gt;</span> img<span class="op">,</span> <span class="dt">final</span> T white <span class="op">)</span></span>
<span id="cb16-17"><a href="#cb16-17" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb16-18"><a href="#cb16-18" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">int</span> n <span class="op">=</span> img<span class="op">.</span><span class="fu">numDimensions</span><span class="op">();</span></span>
<span id="cb16-19"><a href="#cb16-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">long</span><span class="op">[]</span> min <span class="op">=</span> <span class="kw">new</span> <span class="dt">long</span><span class="op">[</span> n <span class="op">];</span></span>
<span id="cb16-20"><a href="#cb16-20" aria-hidden="true" tabindex="-1"></a>        img<span class="op">.</span><span class="fu">min</span><span class="op">(</span> min <span class="op">);</span></span>
<span id="cb16-21"><a href="#cb16-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">long</span><span class="op">[]</span> scale <span class="op">=</span> <span class="kw">new</span> <span class="dt">long</span><span class="op">[</span> n <span class="op">];</span></span>
<span id="cb16-22"><a href="#cb16-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> d <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> d <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>d <span class="op">)</span></span>
<span id="cb16-23"><a href="#cb16-23" aria-hidden="true" tabindex="-1"></a>            scale<span class="op">[</span> d <span class="op">]</span> <span class="op">=</span> img<span class="op">.</span><span class="fu">max</span><span class="op">(</span> d <span class="op">)</span> <span class="op">-</span> min<span class="op">[</span> d <span class="op">];</span></span>
<span id="cb16-24"><a href="#cb16-24" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">long</span><span class="op">[]</span> pos <span class="op">=</span> <span class="kw">new</span> <span class="dt">long</span><span class="op">[</span> n <span class="op">];</span></span>
<span id="cb16-25"><a href="#cb16-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-26"><a href="#cb16-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">RandomAccess</span><span class="op">&lt;</span> T <span class="op">&gt;</span> r <span class="op">=</span> img<span class="op">.</span><span class="fu">randomAccess</span><span class="op">();</span></span>
<span id="cb16-27"><a href="#cb16-27" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">Random</span> random <span class="op">=</span> <span class="kw">new</span> <span class="bu">Random</span><span class="op">();</span></span>
<span id="cb16-28"><a href="#cb16-28" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">1000</span><span class="op">;</span> <span class="op">++</span>i <span class="op">)</span></span>
<span id="cb16-29"><a href="#cb16-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb16-30"><a href="#cb16-30" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> d <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> d <span class="op">&lt;</span> n<span class="op">;</span> <span class="op">++</span>d <span class="op">)</span></span>
<span id="cb16-31"><a href="#cb16-31" aria-hidden="true" tabindex="-1"></a>                pos<span class="op">[</span> d <span class="op">]</span> <span class="op">=</span> min<span class="op">[</span> d <span class="op">]</span> <span class="op">+</span> <span class="op">(</span> <span class="dt">long</span> <span class="op">)</span> <span class="op">(</span> random<span class="op">.</span><span class="fu">nextFloat</span><span class="op">()</span> <span class="op">*</span> scale<span class="op">[</span> d <span class="op">]</span> <span class="op">);</span></span>
<span id="cb16-32"><a href="#cb16-32" aria-hidden="true" tabindex="-1"></a>            r<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> pos <span class="op">);</span></span>
<span id="cb16-33"><a href="#cb16-33" aria-hidden="true" tabindex="-1"></a>            r<span class="op">.</span><span class="fu">get</span><span class="op">().</span><span class="fu">set</span><span class="op">(</span> white <span class="op">);</span></span>
<span id="cb16-34"><a href="#cb16-34" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb16-35"><a href="#cb16-35" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-36"><a href="#cb16-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-37"><a href="#cb16-37" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span> <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> args <span class="op">)</span></span>
<span id="cb16-38"><a href="#cb16-38" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb16-39"><a href="#cb16-39" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> Img<span class="op">&lt;</span> ARGBType <span class="op">&gt;</span> img <span class="op">=</span> <span class="kw">new</span> ArrayImgFactory<span class="op">&lt;</span> ARGBType <span class="op">&gt;()</span></span>
<span id="cb16-40"><a href="#cb16-40" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">create</span><span class="op">(</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[]</span> <span class="op">{</span><span class="dv">400</span><span class="op">,</span> <span class="dv">320</span><span class="op">,</span> <span class="dv">100</span><span class="op">},</span> <span class="kw">new</span> <span class="fu">ARGBType</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb16-41"><a href="#cb16-41" aria-hidden="true" tabindex="-1"></a>        <span class="fu">draw</span><span class="op">(</span> img<span class="op">,</span> <span class="kw">new</span> <span class="fu">ARGBType</span><span class="op">(</span> <span class="bn">0xffffffff</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb16-42"><a href="#cb16-42" aria-hidden="true" tabindex="-1"></a>        ImageJFunctions<span class="op">.</span><span class="fu">show</span><span class="op">(</span> img <span class="op">);</span></span>
<span id="cb16-43"><a href="#cb16-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb16-44"><a href="#cb16-44" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>And we used it on a 3D <code>ARGBType</code> image (which means a color image with red/green/blue/alpha values). Ta daaaaaa…</p>
<section id="notes-1" class="level3">
<h3 class="anchored" data-anchor-id="notes-1">Notes</h3>
<ul>
<li>Besides <code>setPosition()</code> in a single or all dimensions, you can also relatively move a <code>RandomAccess</code> in one or all dimensions, or move the <code>RandomAccess</code> pixel-wise in one dimension (Have a look at the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Positionable.html">Positionable</a> API doc!) Which of those is most efficient depends on the situation.</li>
<li>There is a <code>setPosition()</code> version which takes a <code>Localizable</code>. Often a situation occurs where you want to position accessor <code>a</code> to the same location as accessor <code>b</code>. In this situation you can avoid localizing <code>b</code> into an array and using that array to set the position of <code>a</code>. You can simply <code>a.setPosition( b )</code> because <code>b</code> is <code>Localizable</code>.</li>
<li>By <em>image</em>, we do not necessarily mean <em>pixel image</em>.</li>
<li>we use the generic parameter <code>&lt; T extends Type&lt; T &gt; &gt;</code> instead of <code>&lt; Type &gt;</code> throughout ImgLib2 since that allows us to be more type-safe. Imagine implementing an <code>add(a, b)</code> method for a certain type: using the simpler generic parameter would not allow us to enforce both parameters to have the same subclass of <code>Type</code>!</li>
<li>we create as many variables as possible outside of the loop (in particular, objects) since creating objects costs a bit of execution time and can easily dominate the performance of the algorithm if one is not careful about it.</li>
</ul>
</section>
</section>
<section id="cursor" class="level2">
<h2 class="anchored" data-anchor-id="cursor">Cursor</h2>
<p>A <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Cursor.html">Cursor</a> can be used to visit all pixels of an image once. However, the <code>Cursor</code> concept is not limited to pixel images. A <code>Cursor</code> can be used to iterate every collection of <code>Localizable</code> samples.</p>
<p><code>Cursor</code> provides iteration through the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Iterator.html">net.imglib2.Iterator</a> interface. <code>Iterator.fwd()</code> advances the cursor. <code>Iterator.hasNext()</code> returns true if the cursor can be advanced further. Initially, a <code>Cursor</code> points before the first element. You have to call <code>fwd()</code> once to move to the first element.</p>
<p>Note, that the ImgLib2 <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Iterator.html">net.imglib2.Iterator</a> interface is different from Java’s <a href="http://docs.oracle.com/javase/6/docs/api/index.html?java/util/Iterator.html">java.util.Iterator</a>. However, for convenience, <code>Cursor</code> implements <code>java.util.Iterator</code> as well.</p>
<p>Just like RandomAccess, <code>Cursor</code> extends <code>Sampler</code>, so you can <code>get()</code> the value of the current pixel (respectively sample). It also implements <code>Localizable</code>, so you can query the coordinates of the current sample.</p>
<p>Let’s look at an example: We load an image and find the maximum value (the intensity of the brightest pixel).</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">Cursor</span><span class="op">;</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">Img</span><span class="op">;</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">array</span><span class="op">.</span><span class="im">ArrayImgFactory</span><span class="op">;</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">ImgIOException</span><span class="op">;</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">ImgOpener</span><span class="op">;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">numeric</span><span class="op">.</span><span class="im">integer</span><span class="op">.</span><span class="im">UnsignedByteType</span><span class="op">;</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> FindMaximumValue</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span> <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> args <span class="op">)</span> <span class="kw">throws</span> ImgIOException</span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> Img<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> img <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImgOpener</span><span class="op">().</span><span class="fu">openImg</span><span class="op">(</span> <span class="st">"graffiti.tif"</span><span class="op">,</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> ArrayImgFactory<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;(),</span> <span class="kw">new</span> <span class="fu">UnsignedByteType</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">Cursor</span><span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> cursor <span class="op">=</span> img<span class="op">.</span><span class="fu">cursor</span><span class="op">();</span></span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> max <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span> cursor<span class="op">.</span><span class="fu">hasNext</span><span class="op">()</span> <span class="op">)</span></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>            cursor<span class="op">.</span><span class="fu">fwd</span><span class="op">();</span></span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> UnsignedByteType t <span class="op">=</span> cursor<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>            max <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span><span class="op">(</span> t<span class="op">.</span><span class="fu">get</span><span class="op">(),</span> max <span class="op">);</span></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span> <span class="st">"max = "</span> <span class="op">+</span> max <span class="op">);</span></span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In line <em>014</em> we get a <code>Cursor</code> from the image. In lines <em>016-021</em> we iterate the image using <code>hasNext()</code> and <code>fwd()</code>. In line <em>019</em> we <em>get()</em> the value at the current position. Again, this is an instance of the pixel value type UnsignedByteType that acts as a reference to the pixel.</p>
<p>Cursor implements <code>java.util.Iterator</code> which has the <em>next()</em> method. This is a combination of <em>fwd()</em> and <em>get()</em>. Instead of</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cursor<span class="op">.</span><span class="fu">fwd</span><span class="op">();</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> UnsignedByteType t <span class="op">=</span> cursor<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>we could write</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> UnsignedByteType t <span class="op">=</span> cursor<span class="op">.</span><span class="fu">next</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>For even more syntactic sugar, every <code>IterableInterval</code> (such as <code>Img</code>) implements <a href="http://docs.oracle.com/javase/6/docs/api/index.html?java/lang/Iterable.html">java.lang.Iterable</a>. This allows to use the Java <em>for-each</em> loop and replace the lengthy <code>while</code> loop like so:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(</span> UnsignedByteType t <span class="op">:</span> img <span class="op">)</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>    max <span class="op">=</span> <span class="bu">Math</span><span class="op">.</span><span class="fu">max</span><span class="op">(</span> t<span class="op">.</span><span class="fu">get</span><span class="op">(),</span> max <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>However, note that in this construct the <code>Cursor</code> is hidden and you can not use it to get the current location. Therefore, you will often use the <code>while</code> form.</p>
<p>Let’s extend the previous example. Now we are also interested in the coordinates of the maximum. <code>Cursor</code> extends the <code>Localizable</code> interface which provides methods to get the current location either dimension-by-dimension or all at once. (Have a look at the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Localizable.html">Localizable</a> API doc!)</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">Cursor</span><span class="op">;</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">Img</span><span class="op">;</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">array</span><span class="op">.</span><span class="im">ArrayImgFactory</span><span class="op">;</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">ImgIOException</span><span class="op">;</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">ImgOpener</span><span class="op">;</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">numeric</span><span class="op">.</span><span class="im">integer</span><span class="op">.</span><span class="im">UnsignedByteType</span><span class="op">;</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> FindMaximumValueAndLocation</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span> <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> args <span class="op">)</span> <span class="kw">throws</span> ImgIOException</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> Img<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> img <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImgOpener</span><span class="op">().</span><span class="fu">openImg</span><span class="op">(</span> <span class="st">"graffiti.tif"</span><span class="op">,</span></span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> ArrayImgFactory<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;(),</span> <span class="kw">new</span> <span class="fu">UnsignedByteType</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">Cursor</span><span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> cursor <span class="op">=</span> img<span class="op">.</span><span class="fu">cursor</span><span class="op">();</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> max <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">long</span><span class="op">[]</span> pos <span class="op">=</span> <span class="kw">new</span> <span class="dt">long</span><span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span> cursor<span class="op">.</span><span class="fu">hasNext</span><span class="op">()</span> <span class="op">)</span></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>            cursor<span class="op">.</span><span class="fu">fwd</span><span class="op">();</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> UnsignedByteType t <span class="op">=</span> cursor<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span> t<span class="op">.</span><span class="fu">get</span><span class="op">()</span> <span class="op">&gt;</span> max <span class="op">)</span></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>            <span class="op">{</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                max <span class="op">=</span> t<span class="op">.</span><span class="fu">get</span><span class="op">();</span></span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                cursor<span class="op">.</span><span class="fu">localize</span><span class="op">(</span> pos <span class="op">);</span></span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span> <span class="st">"max = "</span> <span class="op">+</span> max <span class="op">);</span></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span> <span class="st">"found at ( "</span> <span class="op">+</span> pos<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">+</span> <span class="st">", "</span> <span class="op">+</span> pos<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">+</span> <span class="st">")"</span> <span class="op">);</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In line <em>016</em> we create a <code>long[]</code> position field which is updated (<em>024</em>) everytime a better <em>max</em> value is found. Here, we use a 2D position field, because we know, that the position is 2D.</p>
<section id="generic-version" class="level3">
<h3 class="anchored" data-anchor-id="generic-version">Generic version</h3>
<p>Let’s look at a generic version of the <em>maximum-finding</em> example.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">Cursor</span><span class="op">;</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">IterableInterval</span><span class="op">;</span></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">Img</span><span class="op">;</span></span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">array</span><span class="op">.</span><span class="im">ArrayImgFactory</span><span class="op">;</span></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">ImgIOException</span><span class="op">;</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">io</span><span class="op">.</span><span class="im">ImgOpener</span><span class="op">;</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">Type</span><span class="op">;</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">numeric</span><span class="op">.</span><span class="im">integer</span><span class="op">.</span><span class="im">UnsignedByteType</span><span class="op">;</span></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> FindMaximumValueAndLocationGeneric</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span> T <span class="kw">extends</span> <span class="bu">Comparable</span><span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="op">&gt;</span></span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>            <span class="bu">Cursor</span><span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="fu">findmax</span><span class="op">(</span> <span class="dt">final</span> IterableInterval<span class="op">&lt;</span> T <span class="op">&gt;</span> iterable <span class="op">)</span></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">Cursor</span><span class="op">&lt;</span> T <span class="op">&gt;</span> cursor <span class="op">=</span> iterable<span class="op">.</span><span class="fu">cursor</span><span class="op">();</span></span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>        cursor<span class="op">.</span><span class="fu">fwd</span><span class="op">();</span></span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Cursor</span><span class="op">&lt;</span> T <span class="op">&gt;</span> max <span class="op">=</span> cursor<span class="op">.</span><span class="fu">copyCursor</span><span class="op">();</span></span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="op">(</span> cursor<span class="op">.</span><span class="fu">hasNext</span><span class="op">()</span> <span class="op">)</span></span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span> cursor<span class="op">.</span><span class="fu">next</span><span class="op">().</span><span class="fu">compareTo</span><span class="op">(</span> max<span class="op">.</span><span class="fu">get</span><span class="op">()</span> <span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">)</span></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>                max <span class="op">=</span> cursor<span class="op">.</span><span class="fu">copyCursor</span><span class="op">();</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> max<span class="op">;</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span> <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> args <span class="op">)</span> <span class="kw">throws</span> ImgIOException</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> Img<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> img <span class="op">=</span> <span class="kw">new</span> <span class="fu">ImgOpener</span><span class="op">().</span><span class="fu">openImg</span><span class="op">(</span> <span class="st">"graffiti.tif"</span><span class="op">,</span></span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>            <span class="kw">new</span> ArrayImgFactory<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;(),</span> <span class="kw">new</span> <span class="fu">UnsignedByteType</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">Cursor</span><span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> max <span class="op">=</span> <span class="fu">findmax</span><span class="op">(</span> img <span class="op">);</span></span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span> <span class="st">"max = "</span> <span class="op">+</span> max<span class="op">.</span><span class="fu">get</span><span class="op">().</span><span class="fu">get</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>        <span class="bu">System</span><span class="op">.</span><span class="fu">out</span><span class="op">.</span><span class="fu">println</span><span class="op">(</span> <span class="st">"found at ( "</span> <span class="op">+</span> max<span class="op">.</span><span class="fu">getLongPosition</span><span class="op">(</span> <span class="dv">0</span> <span class="op">)</span> <span class="op">+</span> <span class="st">", "</span> <span class="op">+</span></span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>                                            max<span class="op">.</span><span class="fu">getLongPosition</span><span class="op">(</span> <span class="dv">1</span> <span class="op">)</span> <span class="op">+</span> <span class="st">")"</span> <span class="op">);</span></span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We define the method <code>findmax</code> as</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="dt">static</span> <span class="op">&lt;</span> T <span class="kw">extends</span> <span class="bu">Comparable</span><span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="op">&gt;</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>        <span class="bu">Cursor</span><span class="op">&lt;</span> T <span class="op">&gt;</span> <span class="fu">findmax</span><span class="op">(</span> <span class="dt">final</span> IterableInterval<span class="op">&lt;</span> T <span class="op">&gt;</span> iterable <span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First, note that we do not take an <code>Img&lt;T&gt;</code> as the parameter, because that would be too restrictive. All we need is something that is iterable. Because we can easily put interval bounds on every iterable set of Localizables, ImgLib2 does not define an <code>Iterable</code> super-interface for <code>IterableInterval</code>. So <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/IterableInterval.html">IterableInterval<t></t></a> is the most general we can go here.</p>
<p>For finding the maximum, the only restriction we have to put on type <code>T</code> is that it is comparable.</p>
<p>The return value of <code>findmax</code> is a <code>Cursor&lt;T&gt;</code>. Instead of creating a new class that represents a tuple of maximum value and coordinates, we simply return a <code>Cursor</code> positioned at the maximum.</p>
<p>To remember the maximum, we simply take a new copy of the iterating cursor whenever a better <em>max</em> value is found.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span> cursor<span class="op">.</span><span class="fu">next</span><span class="op">().</span><span class="fu">compareTo</span><span class="op">(</span> max<span class="op">.</span><span class="fu">get</span><span class="op">()</span> <span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span> <span class="op">)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    max <span class="op">=</span> cursor<span class="op">.</span><span class="fu">copyCursor</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Remember that <code>next()</code> is equivalent to <code>fwd()</code> followed by <code>get()</code>. So, <code>cursor.next()</code> returns the current <code>T</code>.</p>
<p>Lines <em>028-031</em> show how to use <code>findmax</code> and get the maximum value and coordinates from the resulting <code>Cursor</code>. For a change, we used the dimension-by-dimension <code>getLongPosition()</code> of the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Localizable.html">Localizable</a> interface.</p>
</section>
<section id="notes-2" class="level3">
<h3 class="anchored" data-anchor-id="notes-2">Notes</h3>
<ul>
<li>The iteration order is subject to implementation, specialized for each memory layout to minimize access time. For example, an <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/img/array/ArrayImg.html">ArrayImg</a> has a different iteration order from a <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/img/cell/CellImg.html">CellImg</a>. This is nicely illustrated in <a href="../libs/imglib2/examples#example-2b---duplicating-an-img-using-a-different-imgfactory">ImgLib2 Example 2b - Duplicating an Img using a different ImgFactory</a>.</li>
<li>Typically, there are two variants of Cursors available. One that calculates its location per each iteration and one that calculates it only per localization request. The former is more efficient when localization occurs frequently, the latter otherwise. In the <em>maximum-finding</em> example, we use the latter because localization is only required once after the maximum has been found. The former one could be obtained using <code>localizingCursor()</code> instead of <code>cursor()</code> (see <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/IterableInterval.html">IterableInterval</a> API doc.)</li>
<li><code>copyCursor()</code> is a work-around to circumvent a <em>javac</em> bug with covariant return type overriding (see <a href="http://bugs.sun.com/view_bug.do?bug_id=6656332">bug report</a>). In the future (with JDK7) every <code>Sampler</code> can be copied using <code>copy()</code> instead of having specialised <code>copyCursor()</code>, <code>copyRandomAccess()</code>, … methods.</li>
</ul>
</section>
</section>
<section id="accessors-for-continuous-coordinates" class="level2">
<h2 class="anchored" data-anchor-id="accessors-for-continuous-coordinates">Accessors for Continuous Coordinates</h2>
<p>ImgLib2 is not restricted to rasterized images and integer coordinates It also supports continuous images and real-valued coordinates. Examples where this is appropriate are</p>
<ul>
<li>an interpolated image, where an interpolated value can be obtained at any real coordinate. Note that this is a bounded, but continuous image. Thus it is not iterable.</li>
<li>a procedurally generated image, where a value can be computed at any real coordinate (continuous, unbounded, non-iterable).</li>
<li>collections of samples taken at arbitrary real coordinates (discrete, bounded, iterable).</li>
</ul>
<p>The following image shows the UML diagram for the ImgLib2 accessor interface hierarchy. The real-coordinate counterparts that were missing in the simplified version <a href="../imglib2/accessors.html">above</a> are highlighted.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="media/libs/imglib2/imglib2-accessors-real.png" class="img-fluid figure-img"></p>
<figcaption>UML for ImgLib2 accessor interfaces</figcaption>
</figure>
</div>
<p>Real equivalents of the <code>Positionable</code> and <code>Localizable</code> interfaces have been added by which real-valued coordinates can be accessed.</p>
<p>Something that is <a href="https://javadoc.scijava.org/ImgLib2/net/imglib2/RealPositionable.html">RealPositionable</a> can be positioned at real coordinates. There are methods to set absolute or relative position, for a single or all dimensions, in analogy to the integer <code>Positionable</code>. You can also set a <code>RealPositionable</code> to the location of a <code>RealLocalizable</code>. Note that <a href="https://javadoc.scijava.org/ImgLib2/net/imglib2/RealPositionable.html">RealPositionable</a> extends <code>Positionable</code>, which is quite natural: Whenever something can be positioned at arbitrary real coordinates, of course it can be positioned to integer coordinates as well.</p>
<p><a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RealLocalizable.html">RealLocalizable</a> allows to get a real coordinate from an accessor. Again, this is completely analogous to the integer <code>Localizable</code>. In this case, the inheritance relationship is the other way around - <code>Localizable</code> extends <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RealLocalizable.html">RealLocalizable</a>. Something that is able to provide its integer coordinates is always able to provide them as real coordinates too.</p>
<p>In Combination with <code>Sampler</code>, we obtain random-access and iteration accessor interfaces. <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RealRandomAccess.html">RealRandomAccess</a> provides n-dimensional random access through the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RealPositionable.html">RealPositionable</a> interface. <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RealCursor.html">RealCursor</a> provides iteration through the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/Iterator.html">Iterator</a> interface.</p>
<p>Both, <code>RealRandomAccess</code> and <code>RealCursor</code> are <code>RealLocalizable</code>. Note that the inheritance relationship of <code>Localizable</code> and <code>RealLocalizable</code> propagates to the cursors. Every <code>Cursor</code> is also a <code>RealCursor</code> (because it can provide its current integer coordinates as real coordinates as well). There is no such relationship between <code>RandomAccess</code> and <code>RealRandomAccess</code>.</p>
<section id="a-realrandomaccess-to-render-mandelbrot-fractals" class="level3">
<h3 class="anchored" data-anchor-id="a-realrandomaccess-to-render-mandelbrot-fractals">A RealRandomAccess to Render Mandelbrot Fractals</h3>
<p>Let’s look at an example. The following code defines a <code>RealRandomAccess</code> which computes the <a href="https://en.wikipedia.org/wiki/Mandelbrot_set">Mandelbrot set</a>{% include wikipedia title=‘Mandelbrot set’ text=‘Mandelbrot set’%}. More precisely, our <code>RealRandomAccess</code> can be positioned at an arbitray 2D coordinate in the complex plane. When we <code>get()</code> its value, it computes an iteration count for its current position using an <a href="https://en.wikipedia.org/wiki/Plotting_algorithms_for_the_Mandelbrot_set">Mandelbrot set#Escape_time_algorithm</a> {% include wikipedia title=‘Mandelbrot set#Escape_time_algorithm’ text=‘Escape time algorithm’%}</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">RealPoint</span><span class="op">;</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">RealRandomAccess</span><span class="op">;</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">numeric</span><span class="op">.</span><span class="im">integer</span><span class="op">.</span><span class="im">UnsignedByteType</span><span class="op">;</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> MandelbrotRealRandomAccess <span class="kw">extends</span> RealPoint</span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>        <span class="kw">implements</span> RealRandomAccess<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span></span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">final</span> UnsignedByteType t<span class="op">;</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="fu">MandelbrotRealRandomAccess</span><span class="op">()</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>        <span class="kw">super</span><span class="op">(</span> <span class="dv">2</span> <span class="op">);</span> <span class="co">// number of dimensions is 2</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>        t <span class="op">=</span> <span class="kw">new</span> <span class="fu">UnsignedByteType</span><span class="op">();</span></span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> <span class="fu">mandelbrot</span><span class="op">(</span> <span class="dt">final</span> <span class="dt">double</span> re0<span class="op">,</span> <span class="dt">final</span> <span class="dt">double</span> im0<span class="op">,</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> <span class="dt">int</span> maxIterations <span class="op">)</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> re <span class="op">=</span> re0<span class="op">;</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">double</span> im <span class="op">=</span> im0<span class="op">;</span></span>
<span id="cb25-21"><a href="#cb25-21" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb25-22"><a href="#cb25-22" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span> <span class="op">;</span> i <span class="op">&lt;</span> maxIterations<span class="op">;</span> <span class="op">++</span>i <span class="op">)</span></span>
<span id="cb25-23"><a href="#cb25-23" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb25-24"><a href="#cb25-24" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> <span class="dt">double</span> squre <span class="op">=</span> re <span class="op">*</span> re<span class="op">;</span></span>
<span id="cb25-25"><a href="#cb25-25" aria-hidden="true" tabindex="-1"></a>            <span class="dt">final</span> <span class="dt">double</span> squim <span class="op">=</span> im <span class="op">*</span> im<span class="op">;</span></span>
<span id="cb25-26"><a href="#cb25-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="op">(</span> squre <span class="op">+</span> squim <span class="op">&gt;</span> <span class="dv">4</span> <span class="op">)</span></span>
<span id="cb25-27"><a href="#cb25-27" aria-hidden="true" tabindex="-1"></a>                <span class="cf">break</span><span class="op">;</span></span>
<span id="cb25-28"><a href="#cb25-28" aria-hidden="true" tabindex="-1"></a>            im <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> re <span class="op">*</span> im <span class="op">+</span> im0<span class="op">;</span></span>
<span id="cb25-29"><a href="#cb25-29" aria-hidden="true" tabindex="-1"></a>            re <span class="op">=</span> squre <span class="op">-</span> squim <span class="op">+</span> re0<span class="op">;</span></span>
<span id="cb25-30"><a href="#cb25-30" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb25-31"><a href="#cb25-31" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> i<span class="op">;</span></span>
<span id="cb25-32"><a href="#cb25-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-33"><a href="#cb25-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-34"><a href="#cb25-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb25-35"><a href="#cb25-35" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> UnsignedByteType <span class="fu">get</span><span class="op">()</span></span>
<span id="cb25-36"><a href="#cb25-36" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb25-37"><a href="#cb25-37" aria-hidden="true" tabindex="-1"></a>        t<span class="op">.</span><span class="fu">set</span><span class="op">(</span> <span class="fu">mandelbrot</span><span class="op">(</span> position<span class="op">[</span> <span class="dv">0</span> <span class="op">],</span> position<span class="op">[</span> <span class="dv">1</span> <span class="op">],</span> <span class="dv">255</span> <span class="op">)</span> <span class="op">);</span></span>
<span id="cb25-38"><a href="#cb25-38" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> t<span class="op">;</span></span>
<span id="cb25-39"><a href="#cb25-39" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-40"><a href="#cb25-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-41"><a href="#cb25-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb25-42"><a href="#cb25-42" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> MandelbrotRealRandomAccess <span class="fu">copyRealRandomAccess</span><span class="op">()</span></span>
<span id="cb25-43"><a href="#cb25-43" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb25-44"><a href="#cb25-44" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="fu">copy</span><span class="op">();</span></span>
<span id="cb25-45"><a href="#cb25-45" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-46"><a href="#cb25-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-47"><a href="#cb25-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">@Override</span></span>
<span id="cb25-48"><a href="#cb25-48" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> MandelbrotRealRandomAccess <span class="fu">copy</span><span class="op">()</span></span>
<span id="cb25-49"><a href="#cb25-49" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb25-50"><a href="#cb25-50" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> MandelbrotRealRandomAccess a <span class="op">=</span> <span class="kw">new</span> <span class="fu">MandelbrotRealRandomAccess</span><span class="op">();</span></span>
<span id="cb25-51"><a href="#cb25-51" aria-hidden="true" tabindex="-1"></a>        a<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> <span class="kw">this</span> <span class="op">);</span></span>
<span id="cb25-52"><a href="#cb25-52" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb25-53"><a href="#cb25-53" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb25-54"><a href="#cb25-54" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>First of all, note that we extend <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RealPoint.html">RealPoint</a>. Instead of implementing the interface <code>RealRandomAccess&lt; UnsignedByteType &gt;</code>, we make use of this classawhich has most of the required methods implemented already.</p>
<p>Actually, all we are left with is to implement the <code>Sampler&lt; UnsignedByteType &gt;</code> interface. ImgLib2 provides several such abstract implementations to minimize development time for new accessor types. The UML diagram below shows <code>MandelbrotRealRandomAccess</code> and the derivative hierarchy of its parent classes.</p>
<p>The value (iteration count) at a 2D position <em>(re0,im0)</em> is computer in the static method <code>mandelbrot()</code> in lines <em>016-032</em>. When calling it, we set the maximum number of iterations to 255. Thus we can use <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/type/numeric/integer/UnsignedByteType.html">UnsignedByteType</a> as the value type of our accessor. Therefore, we implement the interface <code>RealRandomAccess&lt; UnsignedByteType &gt;</code>.</p>
<p>In the constructor in lines <em>010-014</em>, we call the super class constructor to initialise a 2-dimensional <code>RealPoint</code>. We create the <code>UnsignedByteType</code> member <code>t</code> (declared in line <em>008</em>) which will store the value that is returned by <code>get()</code>.</p>
<p>Our super class <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RealPoint.html">RealPoint</a> implements the <code>RealPositionable</code> and <code>RealLocalizable</code>. We have access to the current position through the <code>double[] position</code> field inherited from <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RealLocalizable.html">RealLocalizable</a>. In <code>get()</code> (lines <em>035-038</em>) we use it to compute the value at the current position. The value is stored in <code>t</code> which is returned.</p>
<p>Finally, we provide the <code>copy()</code> and <code>copyRealRandomAccess()</code> methods to complete the <code>RealRandomAccess</code> interface implementation. A copied accessor is supposed to refer to the same position and value, therefore we <code>setPosition</code> in line <em>051</em>.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="Media_imglib2/imglib2-abstract-accessors-real-new-vertical.png" class="img-fluid figure-img"></p>
<figcaption>UML for abstract RealRandomAccess class hierarchy</figcaption>
</figure>
</div>
<p>Now let’s use the <code>MandelbrotRealRandomAccess</code> to render a pixel image:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">Cursor</span><span class="op">;</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">RealLocalizable</span><span class="op">;</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">RealRandomAccess</span><span class="op">;</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">Img</span><span class="op">;</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">array</span><span class="op">.</span><span class="im">ArrayImgFactory</span><span class="op">;</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">img</span><span class="op">.</span><span class="im">display</span><span class="op">.</span><span class="im">imagej</span><span class="op">.</span><span class="im">ImageJFunctions</span><span class="op">;</span></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> <span class="im">net</span><span class="op">.</span><span class="im">imglib2</span><span class="op">.</span><span class="im">type</span><span class="op">.</span><span class="im">numeric</span><span class="op">.</span><span class="im">integer</span><span class="op">.</span><span class="im">UnsignedByteType</span><span class="op">;</span></span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a><span class="kw">public</span> <span class="kw">class</span> DrawMandelbrot</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">public</span> <span class="dt">static</span> <span class="dt">void</span> <span class="fu">main</span><span class="op">(</span> <span class="dt">final</span> <span class="bu">String</span><span class="op">[]</span> args <span class="op">)</span></span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">int</span><span class="op">[]</span> dimensions <span class="op">=</span> <span class="kw">new</span> <span class="dt">int</span><span class="op">[]</span> <span class="op">{</span> <span class="dv">600</span><span class="op">,</span> <span class="dv">400</span> <span class="op">};</span></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> Img<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> img <span class="op">=</span> <span class="kw">new</span> ArrayImgFactory<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;()</span></span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">create</span><span class="op">(</span> dimensions<span class="op">,</span> <span class="kw">new</span> <span class="fu">UnsignedByteType</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> RealRandomAccess<span class="op">&lt;</span>UnsignedByteType<span class="op">&gt;</span> mb <span class="op">=</span> <span class="kw">new</span> <span class="fu">MandelbrotRealRandomAccess</span><span class="op">();</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">double</span> scale <span class="op">=</span> <span class="fl">0.005</span><span class="op">;</span></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="dt">double</span><span class="op">[]</span> offset <span class="op">=</span> <span class="kw">new</span> <span class="dt">double</span><span class="op">[]</span> <span class="op">{</span> <span class="op">-</span><span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">1</span> <span class="op">};</span></span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a>        <span class="dt">final</span> <span class="bu">Cursor</span><span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> cursor <span class="op">=</span> img<span class="op">.</span><span class="fu">localizingCursor</span><span class="op">();</span></span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span><span class="op">(</span> cursor<span class="op">.</span><span class="fu">hasNext</span><span class="op">()</span> <span class="op">)</span></span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span></span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>            cursor<span class="op">.</span><span class="fu">fwd</span><span class="op">();</span></span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> d <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> d <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> <span class="op">++</span>d <span class="op">)</span></span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>                mb<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> scale <span class="op">*</span> cursor<span class="op">.</span><span class="fu">getIntPosition</span><span class="op">(</span> d <span class="op">)</span> <span class="op">+</span> offset<span class="op">[</span> d <span class="op">],</span> d <span class="op">);</span></span>
<span id="cb26-28"><a href="#cb26-28" aria-hidden="true" tabindex="-1"></a>            cursor<span class="op">.</span><span class="fu">get</span><span class="op">().</span><span class="fu">set</span><span class="op">(</span> mb<span class="op">.</span><span class="fu">get</span><span class="op">()</span> <span class="op">);</span></span>
<span id="cb26-29"><a href="#cb26-29" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb26-30"><a href="#cb26-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-31"><a href="#cb26-31" aria-hidden="true" tabindex="-1"></a>        ImageJFunctions<span class="op">.</span><span class="fu">show</span><span class="op">(</span> img <span class="op">);</span></span>
<span id="cb26-32"><a href="#cb26-32" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb26-33"><a href="#cb26-33" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We start by creating a 600×400 <code>UnsignedByteType</code> pixel image (lines <em>013-015</em>). This is the target image into which we will render the mandelbrot fractal and which we will eventually display on screen (line <em>031</em>).</p>
<p>We create a <code>MandelbrotRealRandomAccess</code> which will provide samples from the fractal at arbitray positions.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> RealRandomAccess<span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> mb <span class="op">=</span> <span class="kw">new</span> <span class="fu">MandelbrotRealRandomAccess</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We render the fractal by iterating and setting the pixels of the target image (lines <em>022-029</em>). In this case, we use a localizing <code>Cursor</code> because we need the cursor’s position at every pixel.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="bu">Cursor</span><span class="op">&lt;</span> UnsignedByteType <span class="op">&gt;</span> cursor <span class="op">=</span> img<span class="op">.</span><span class="fu">localizingCursor</span><span class="op">();</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The current coordinates of the cursor are transferred to the <code>RealRandomAccess</code> using a scale factor and an offset. (Scale and offset are defined in lines <em>019-020</em>.) We set the coordinates dimension-by-dimension:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span> <span class="dt">int</span> d <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> d <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> <span class="op">++</span>d <span class="op">)</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    mb<span class="op">.</span><span class="fu">setPosition</span><span class="op">(</span> scale <span class="op">*</span> cursor<span class="op">.</span><span class="fu">getIntPosition</span><span class="op">(</span> d <span class="op">)</span> <span class="op">+</span> offset<span class="op">[</span> d <span class="op">],</span> d <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Finally, we get a reference to the current pixel, and set it to the value computed by the <code>MandelbrotRealRandomAccess</code>.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>cursor<span class="op">.</span><span class="fu">get</span><span class="op">().</span><span class="fu">set</span><span class="op">(</span> mb<span class="op">.</span><span class="fu">get</span><span class="op">()</span> <span class="op">);</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><code>cursor.get()</code> gives the <code>UnsignedByteType</code> reference to the value under the cursor. <code>mb.get()</code> gives the <code>UnsignedByteType</code> reference to the value computed by the <code>MandelbrotRealRandomAccess</code>. Then we <code>set()</code> the value of the former to the value of the latter.</p>
<p>When you run the code you will see this: <img src="media/libs/imglib2/mandelbrot-1.png" class="img-fluid" style="width: 300px" data-caption="Mandelbrot fractal" alt="mandelbrot-1"></p>
<p>Because we have a <code>RealRandomAccess</code> you can zoom in indefinitely (until you hit the <code>double</code> precision limit). If you like, you can play around with the scale and offset values. Here is another example obtained with</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode java code-with-copy"><code class="sourceCode java"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="dt">double</span> scale <span class="op">=</span> <span class="fl">0.000125</span><span class="op">;</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="dt">final</span> <span class="dt">double</span><span class="op">[]</span> offset <span class="op">=</span> <span class="kw">new</span> <span class="dt">double</span><span class="op">[]</span> <span class="op">{</span> <span class="op">-</span><span class="fl">1.3875</span><span class="op">,</span> <span class="fl">0.045</span> <span class="op">};</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><img src="media/libs/imglib2/mandelbrot-2.png" class="img-fluid" style="width: 300px" data-caption="Mandelbrot fractal"></p>
</section>
<section id="notes-3" class="level3">
<h3 class="anchored" data-anchor-id="notes-3">Notes</h3>
<ul>
<li>In line <em>017</em> we used a <code>RealRandomAccess&lt; UnsignedByteType &gt;</code> variable just to emphasize again the interface implemented by <code>MandelbrotRealRandomAccess</code>. In real code, you would probably use the actual type.</li>
<li>Sampling from a transformed <code>RealRandomAccess</code> to create a pixel image is a quite common task. ImgLib2 provides a framework for on-the-fly transformations, which will be explained later.</li>
<li>The <code>RealPositionable</code>, <code>RealLocalizable</code>, … interfaces are not restricted to accessors. For example, the <a href="http://javadoc.scijava.org/ImgLib2/net/imglib2/RealPoint.html">RealPoint</a> class implements <code>RealPositionable</code> and <code>RealLocalizable</code>, and simply represents a n-dimensional coordinate.</li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/imglib\.github\.io\/imglib2-www");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>